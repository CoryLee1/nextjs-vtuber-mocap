# VTuber Motion Capture Application

一个基于 Next.js 的 VTuber 动捕应用，支持实时面部表情、身体姿态和手部动作捕捉。

## 🚀 功能特性

### 核心功能
- **实时动捕**: 使用 MediaPipe 进行面部、身体和手部动作捕捉
- **VRM 模型支持**: 支持加载和显示 VRM 格式的 3D 模型
- **多语言支持**: 支持中文、英文、日文
- **调试工具**: 内置坐标轴调试面板，可实时调整动捕数据映射

### 动捕功能
- **面部表情**: 眨眼、口型同步、头部旋转
- **身体姿态**: 手臂、躯干、腿部动作
- **手部动作**: 手掌旋转、手指弯曲
- **实时预览**: 3D 场景中的实时动作预览

## 🛠️ 技术栈

- **前端框架**: Next.js 14 (App Router)
- **3D 渲染**: Three.js + @react-three/fiber
- **VRM 支持**: @pixiv/three-vrm
- **动捕库**: MediaPipe + Kalidokit
- **UI 组件**: Tailwind CSS + shadcn/ui
- **国际化**: next-intl

## 📁 项目结构

```
src/
├── app/                    # Next.js App Router
│   ├── [locale]/          # 国际化路由
│   └── globals.css        # 全局样式
├── components/             # React 组件
│   ├── dressing-room/     # 主要功能组件
│   ├── ui/               # UI 组件库
│   └── layout/           # 布局组件
├── hooks/                # 自定义 Hooks
├── lib/                  # 工具库
├── types/                # TypeScript 类型定义
└── i18n/                # 国际化配置
```

## 🎯 动捕逻辑说明

### 数据流程
1. **摄像头输入** → MediaPipe 处理 → Kalidokit 转换 → VRM 模型应用

### 坐标轴映射
动捕数据需要经过坐标轴转换才能正确映射到 VRM 模型：

#### 手臂映射
- **左臂**: `X: -1, Y: 1, Z: -1`
- **右臂**: `X: -1, Y: 1, Z: -1`

#### 手掌映射
- **左手**: `X: -1, Y: 1, Z: -1`
- **右手**: `X: -1, Y: 1, Z: -1`

#### 手指映射 (待调试)
当前手指映射存在问题，需要进一步调试：
- 每个手指关节都有独立的 X/Y/Z 轴向配置
- 需要逐个调试每个手指的弯曲方向

### 调试面板使用
1. 开启调试模式：控制面板 → 显示调试信息
2. 调整轴向：点击对应轴向按钮切换 1/-1
3. 实时预览：观察 3D 模型响应
4. 保存配置：点击"保存"按钮

## 🐛 已知问题

### 手指映射问题
- **问题**: 手指弯曲方向不正确，难以看出变化
- **原因**: 手指关节的坐标轴映射需要精细调整
- **解决方案**: 使用详细手指调试面板逐个调试

### 模型加载问题
- **问题**: 模型加载时缺少进度提示
- **解决方案**: 已添加加载状态指示器

### 语言切换问题
- **问题**: 语言切换功能不工作
- **状态**: 需要检查 next-intl 配置

## 🚀 快速开始

### 环境要求
- Node.js 18+
- npm 或 yarn

### 安装依赖
```bash
npm install
```

### 开发模式
```bash
npm run dev
```

### 构建生产版本
```bash
npm run build
```

## 📖 使用指南

### 基本操作
1. **开启摄像头**: 点击控制面板中的摄像头按钮
2. **选择模型**: 使用模型管理器选择 VRM 模型
3. **调整设置**: 在控制面板中调整各种参数
4. **调试动捕**: 使用调试面板调整坐标轴映射

### 调试技巧
1. **手臂调试**: 举起手臂观察模型响应
2. **手掌调试**: 旋转手掌观察方向
3. **手指调试**: 逐个弯曲手指观察效果
4. **保存配置**: 找到正确配置后及时保存

## 🔧 开发说明

### 添加新的动捕功能
1. 在 `VRMAvatar.tsx` 中添加新的处理逻辑
2. 在调试面板中添加对应的控制选项
3. 更新类型定义和文档

### 自定义坐标轴映射
1. 修改 `ArmDebugPanel.jsx` 中的默认配置
2. 在 `VTuberScene.tsx` 中更新状态管理
3. 在 `VRMAvatar.tsx` 中应用新的映射逻辑

## 📝 更新日志

### v1.0.0
- ✅ 基础动捕功能
- ✅ VRM 模型支持
- ✅ 调试面板
- ✅ 多语言支持
- 🔄 手指映射调试中
- 🔄 语言切换修复中

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

MIT License