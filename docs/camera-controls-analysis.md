# CameraControls 替换分析

## 当前实现分析

### 核心功能

1. **自动跟踪 VRM 头部骨骼** ✅ **关键功能**
   - 在 `useFrame` 中每帧更新目标点
   - 从 VRM 模型的 `head` 骨骼获取世界坐标
   - 支持动态目标跟踪

2. **球面坐标系控制**
   - 使用 `Spherical` 坐标系统
   - 支持 `phi`（垂直角度）和 `theta`（水平角度）限制

3. **多层阻尼系统**
   - `positionDamping`: 0.08
   - `rotationDamping`: 0.12
   - `zoomDamping`: 0.4

4. **惯性滑动**
   - `enableInertia`: true
   - `inertiaDecay`: 0.42
   - 支持旋转和缩放的惯性

5. **自定义配置**
   - 距离限制（minDistance: 0.5, maxDistance: 10）
   - 角度限制（minPhi, maxPhi）
   - 灵敏度配置

6. **触摸屏支持**
   - 完整的手势识别
   - 双指缩放
   - 单指旋转

## drei CameraControls 分析

根据 [drei 文档](https://drei.docs.pmnd.rs/controls/camera-controls)：

### 优点

1. ✅ **成熟稳定** - 基于 camera-controls 库，经过大量项目验证
2. ✅ **代码简洁** - 大幅减少代码量（当前实现约 975 行）
3. ✅ **功能完整** - 支持旋转、缩放、平移
4. ✅ **触摸支持** - 内置触摸手势
5. ✅ **可配置** - 支持鼠标按钮映射
6. ✅ **事件回调** - onControlStart, onControl, onControlEnd 等

### 潜在问题

1. ⚠️ **动态目标跟踪** - 需要验证是否支持每帧更新 `target`
2. ⚠️ **球面坐标限制** - 需要验证是否支持 `phi` 和 `theta` 的角度限制
3. ⚠️ **自定义阻尼** - 需要验证是否支持分别配置位置/旋转/缩放的阻尼
4. ⚠️ **惯性配置** - 需要验证惯性衰减是否可配置

## 替换方案

### 方案 1: 完全替换（推荐，需验证）

**前提条件**：
- 确认 `CameraControls` 的 `setTarget` 方法可以在 `useFrame` 中每帧调用
- 确认支持角度限制（polar angle / azimuth angle）
- 确认支持自定义阻尼配置

**实现步骤**：
1. 安装/确认 `@react-three/drei` 已包含 `CameraControls`
2. 创建包装组件，在 `useFrame` 中更新目标点
3. 迁移配置选项
4. 测试所有功能

**优点**：
- 代码量大幅减少
- 维护成本低
- 功能更稳定

**缺点**：
- 如果无法满足需求，需要回退
- 可能失去一些自定义功能

### 方案 2: 混合方案

保留当前实现，但参考 `CameraControls` 的 API 设计优化代码结构。

### 方案 3: 渐进替换

1. 先替换基础控制逻辑（旋转、缩放、平移）
2. 保留自定义的自动跟踪逻辑
3. 逐步迁移其他功能

## 建议

**推荐：先验证，再决定**

1. ✅ **可以替换**，如果：
   - `CameraControls` 支持动态 `setTarget`
   - 支持角度限制
   - 支持自定义阻尼

2. ⚠️ **需要混合**，如果：
   - 不支持动态目标，需要在 `useFrame` 中手动更新
   - 部分功能需要自定义实现

3. ❌ **不建议替换**，如果：
   - 关键功能无法满足
   - 实现复杂度反而增加

## 验证步骤

1. 创建测试组件，验证 `setTarget` 在 `useFrame` 中的使用
2. 测试角度限制功能
3. 测试阻尼配置
4. 测试触摸手势
5. 对比性能和用户体验





