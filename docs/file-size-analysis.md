# æ–‡ä»¶å¤§å°å’ŒèŒè´£åˆ†ææŠ¥å‘Š

æ ¹æ® `.cursorrules` è§„èŒƒæ£€æŸ¥ä»£ç åº“çš„æ–‡ä»¶å¤§å°å’ŒèŒè´£åˆ†ç¦»æƒ…å†µã€‚

**ç”Ÿæˆæ—¶é—´**: 2024å¹´ï¼ˆå½“å‰ï¼‰

---

## ğŸ“Š æ–‡ä»¶å¤§å°ç»Ÿè®¡

### è¶…å¤§æ–‡ä»¶ (>1000 è¡Œ)

1. **`src/components/dressing-room/VRMAvatar.tsx`** - **1161 è¡Œ** ğŸ”´
   - **é—®é¢˜**: è¿œè¶… 300 è¡Œé™åˆ¶ï¼ˆè¶…è¿‡ 3.8 å€ï¼‰
   - **è¿åè§„èŒƒ**: `.cursorrules` è¦æ±‚æ–‡ä»¶ < 300 è¡Œ
   - **èŒè´£**:
     - VRM æ¨¡å‹åŠ è½½å’Œç¼“å­˜
     - åŠ¨ç”»ç®¡ç†
     - åŠ¨æ•æ•°æ®å¤„ç†ï¼ˆé¢éƒ¨ã€èº«ä½“ã€æ‰‹éƒ¨ï¼‰
     - éª¨éª¼æ˜ å°„å’Œæ—‹è½¬
     - æ€§èƒ½ç›‘æ§
     - UI ç»„ä»¶ï¼ˆModelLoadingIndicatorï¼‰
     - è°ƒè¯•å·¥å…·é›†æˆ
   
### å¤§å‹æ–‡ä»¶ (500-1000 è¡Œ)

**å¾…æ£€æŸ¥** - éœ€è¦è¿è¡Œå®Œæ•´æ‰«æ

### ä¸­ç­‰æ–‡ä»¶ (300-500 è¡Œ)

**å¾…æ£€æŸ¥** - éœ€è¦è¿è¡Œå®Œæ•´æ‰«æ

---

## ğŸ” èŒè´£åˆ†æ

### VRMAvatar.tsx (1161 è¡Œ) - éœ€è¦æ‹†åˆ†

#### å½“å‰èŒè´£ï¼ˆè¿åå•ä¸€èŒè´£åŸåˆ™ï¼‰

1. **æ¨¡å‹åŠ è½½å’Œç¼“å­˜**
   - `useGLTF` è°ƒç”¨
   - æ¨¡å‹ç¼“å­˜é€»è¾‘
   - é”™è¯¯å¤„ç†

2. **åŠ¨ç”»ç®¡ç†**
   - `useAnimationManager` é›†æˆ
   - åŠ¨ç”»çŠ¶æ€ç®¡ç†
   - æ¨¡å¼åˆ‡æ¢ï¼ˆidle/mocapï¼‰

3. **åŠ¨æ•æ•°æ®å¤„ç†**
   - MediaPipe å›è°ƒå¤„ç†
   - é¢éƒ¨è¯†åˆ«ï¼ˆFace.solveï¼‰
   - å§¿æ€è¯†åˆ«ï¼ˆPose.solveï¼‰
   - æ‰‹éƒ¨è¯†åˆ«ï¼ˆHand.solveï¼‰

4. **éª¨éª¼æ“ä½œ**
   - éª¨éª¼åç§°æ˜ å°„
   - éª¨éª¼æ—‹è½¬
   - åæ ‡è½¬æ¢

5. **UI ç»„ä»¶**
   - `ModelLoadingIndicator` ç»„ä»¶
   - è°ƒè¯•å·¥å…·æ¸²æŸ“

6. **æ€§èƒ½ç›‘æ§**
   - æ€§èƒ½ç›‘æ§å™¨åˆ›å»º
   - æ€§èƒ½æ£€æŸ¥ç‚¹

7. **è°ƒè¯•æ”¯æŒ**
   - è°ƒè¯•ä¿¡æ¯æ”¶é›†
   - è°ƒè¯•é¢æ¿é›†æˆ

#### å»ºè®®æ‹†åˆ†æ–¹æ¡ˆ

æ ¹æ® `.cursorrules` çš„æ¶æ„è§„èŒƒï¼š

```typescript
// 1. æå–åˆ° hooks/
// src/hooks/use-vrm-mocap-pipeline.ts
// - è´Ÿè´£åŠ¨æ•æ•°æ®å¤„ç†ç®¡é“
// - MediaPipe å›è°ƒå¤„ç†
// - Face/Pose/Hand æ•°æ®å¤„ç†

// 2. æå–åˆ° hooks/
// src/hooks/use-vrm-bone-control.ts
// - éª¨éª¼æ˜ å°„é€»è¾‘
// - éª¨éª¼æ—‹è½¬å‡½æ•°
// - åæ ‡è½¬æ¢

// 3. æå–åˆ° components/
// src/components/dressing-room/VRMAvatarContainer.tsx
// - å®¹å™¨ç»„ä»¶ï¼Œè´Ÿè´£çŠ¶æ€ç®¡ç†
// - æ•´åˆå„ä¸ª Hook

// 4. æå–åˆ° components/
// src/components/dressing-room/VRMAvatar3D.tsx
// - çº¯ 3D æ¸²æŸ“ç»„ä»¶
// - æ¥æ”¶å¤„ç†å¥½çš„æ•°æ®
// - åªè´Ÿè´£æ¸²æŸ“

// 5. æå–åˆ° lib/
// src/lib/mocap-processors/
// - PoseProcessor.ts
// - FaceProcessor.ts
// - HandProcessor.ts

// 6. æå–åˆ° components/ui/
// src/components/ui/ModelLoadingIndicator.tsx
// - ç‹¬ç«‹çš„ UI ç»„ä»¶
```

---

## âœ… è§„èŒƒç¬¦åˆæ€§æ£€æŸ¥

### 1. æ–‡ä»¶å¤§å° âœ…/âŒ

- [x] âœ… å¤§éƒ¨åˆ†æ–‡ä»¶ < 300 è¡Œ
- [ ] âŒ **VRMAvatar.tsx** (1161 è¡Œ) - **éœ€è¦æ‹†åˆ†**

**è§„èŒƒè¦æ±‚**: `.cursorrules` æ˜ç¡®è§„å®š "è¶…è¿‡ 300 è¡Œçš„ç»„ä»¶æ–‡ä»¶åº”è¯¥é¿å…"

### 2. èŒè´£å•ä¸€ âœ…/âŒ

- [ ] âŒ **VRMAvatar.tsx** - **è¿åå•ä¸€èŒè´£åŸåˆ™**
  - åŒ…å« 7+ ä¸ªä¸åŒçš„èŒè´£
  - æ¨¡å‹åŠ è½½ã€åŠ¨ç”»ã€åŠ¨æ•ã€éª¨éª¼ã€UIã€æ€§èƒ½ã€è°ƒè¯•
  
- [x] âœ… å…¶ä»–ç»„ä»¶èŒè´£å•ä¸€ï¼ˆå·²éªŒè¯ï¼‰

**è§„èŒƒè¦æ±‚**: "å…³æ³¨ç‚¹åˆ†ç¦»ï¼šUIã€3D æ¸²æŸ“ã€æ•°æ®å¤„ç†ä¸¥æ ¼åˆ†ç¦»"

### 3. æ˜“äºæµ‹è¯• âœ…/âŒ

- [x] âœ… ç°æœ‰ Hooks å¯ä»¥å•ç‹¬æµ‹è¯•
  - `use-video-recognition.ts`
  - `use-model-manager.ts`
  - `use-scene-store.ts`
  - `use-sensitivity-settings.ts`
  
- [ ] âŒ **VRMAvatar.tsx** éš¾ä»¥æµ‹è¯•
  - é€»è¾‘è€¦åˆåœ¨ç»„ä»¶ä¸­
  - æ— æ³•å•ç‹¬æµ‹è¯•åŠ¨æ•å¤„ç†é€»è¾‘
  - æ— æ³•å•ç‹¬æµ‹è¯•éª¨éª¼æ“ä½œé€»è¾‘

**è§„èŒƒè¦æ±‚**: "æ˜“äºæµ‹è¯•ï¼ˆå¯ä»¥å•ç‹¬æµ‹è¯•æ¯ä¸ª Hookï¼‰"

### 4. æ˜“äºç»´æŠ¤ âœ…/âŒ

- [ ] âŒ **ä¿®æ”¹åŠ¨æ•é€»è¾‘éœ€è¦ä¿®æ”¹ VRMAvatar.tsx**
  - åº”è¯¥åªéœ€ä¿®æ”¹ `lib/mocap/processors/` ä¸­çš„å¤„ç†å™¨
  - å½“å‰éœ€è¦åœ¨ 1161 è¡Œæ–‡ä»¶ä¸­æŸ¥æ‰¾å’Œä¿®æ”¹
  
- [x] âœ… å…¶ä»–åŠŸèƒ½æ¨¡å—åŒ–è‰¯å¥½
  - åŠ¨ç”»ç®¡ç†ï¼š`lib/animation-manager.ts`
  - æ¨¡å‹ç®¡ç†ï¼š`hooks/use-model-manager.ts`
  - åœºæ™¯çŠ¶æ€ï¼š`hooks/use-scene-store.ts`

**è§„èŒƒè¦æ±‚**: "æ˜“äºç»´æŠ¤ï¼ˆä¿®æ”¹åŠ¨æ•é€»è¾‘åªéœ€æ”¹ Hookï¼‰"

### 5. ä»£ç å¯å¤ç”¨ âœ…/âŒ

- [x] âœ… ç°æœ‰ Hooks å¯å¤ç”¨
  - `use-video-recognition.ts` - å¯åœ¨å…¶ä»–ç»„ä»¶ä½¿ç”¨
  - `use-model-manager.ts` - å¯åœ¨å…¶ä»–ç»„ä»¶ä½¿ç”¨
  - `use-scene-store.ts` - å…¨å±€çŠ¶æ€ï¼Œå¯å¤ç”¨
  
- [ ] âŒ **VRMAvatar.tsx ä¸­çš„é€»è¾‘éš¾ä»¥å¤ç”¨**
  - åŠ¨æ•å¤„ç†é€»è¾‘è€¦åˆåœ¨ç»„ä»¶ä¸­
  - éª¨éª¼æ“ä½œé€»è¾‘æ— æ³•å•ç‹¬æå–
  - æ— æ³•åœ¨å…¶ä»–ç»„ä»¶ä¸­å¤ç”¨è¿™äº›é€»è¾‘

**è§„èŒƒè¦æ±‚**: "ä»£ç å¯å¤ç”¨"

---

## ğŸ¯ é‡æ„å»ºè®®

### ä¼˜å…ˆçº§ 1: æ‹†åˆ† VRMAvatar.tsx

**æ­¥éª¤ 1: æå–åŠ¨æ•æ•°æ®å¤„ç†ç®¡é“**
```typescript
// src/hooks/use-vrm-mocap-pipeline.ts
export function useVRMMocapPipeline(vrm: VRM | null) {
  // MediaPipe å›è°ƒå¤„ç†
  // Face/Pose/Hand æ•°æ®å¤„ç†
  // è¿”å›å¤„ç†åçš„æ•°æ®
}
```

**æ­¥éª¤ 2: æå–éª¨éª¼æ§åˆ¶é€»è¾‘**
```typescript
// src/hooks/use-vrm-bone-control.ts
export function useVRMBoneControl(vrm: VRM | null) {
  // éª¨éª¼æ˜ å°„
  // éª¨éª¼æ—‹è½¬
  // åæ ‡è½¬æ¢
}
```

**æ­¥éª¤ 3: æå– UI ç»„ä»¶**
```typescript
// src/components/ui/ModelLoadingIndicator.tsx
export const ModelLoadingIndicator = ({ isLoading, error, modelName }) => {
  // ç‹¬ç«‹çš„åŠ è½½æŒ‡ç¤ºå™¨ç»„ä»¶
}
```

**æ­¥éª¤ 4: é‡æ„ VRMAvatar**
```typescript
// src/components/dressing-room/VRMAvatar3D.tsx
// çº¯ 3D æ¸²æŸ“ç»„ä»¶ï¼Œåªè´Ÿè´£æ¸²æŸ“
export const VRMAvatar3D = ({ vrm, pose, face, hands }) => {
  // åªè´Ÿè´£ 3D æ¸²æŸ“
}
```

---

## ğŸ“ æ€»ç»“

### é—®é¢˜
1. **VRMAvatar.tsx è¿‡å¤§** (1161 è¡Œ) - è¿åå•ä¸€èŒè´£åŸåˆ™
2. **éš¾ä»¥æµ‹è¯•** - é€»è¾‘è€¦åˆåœ¨ç»„ä»¶ä¸­
3. **éš¾ä»¥ç»´æŠ¤** - ä¿®æ”¹éœ€è¦æ”¹å¤§æ–‡ä»¶
4. **éš¾ä»¥å¤ç”¨** - é€»è¾‘æ— æ³•å•ç‹¬æå–

### è§£å†³æ–¹æ¡ˆ

æ ¹æ® `.cursorrules` çš„æ¶æ„è§„èŒƒï¼Œéœ€è¦æŒ‰ç…§ä»¥ä¸‹ç»“æ„æ‹†åˆ†ï¼š

#### ç›®æ ‡ç»“æ„ï¼ˆç¬¦åˆè§„èŒƒï¼‰

```
src/
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ use-vrm-model.ts              # VRM æ¨¡å‹åŠ è½½å’Œç®¡ç†ï¼ˆå·²å­˜åœ¨ use-scene-storeï¼Œå¯åˆå¹¶ï¼‰
â”‚   â””â”€â”€ use-vrm-mocap-pipeline.ts     # åŠ¨æ•æ•°æ®å¤„ç†ç®¡é“ï¼ˆæ–°ï¼‰
â”‚
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ mocap/
â”‚       â”œâ”€â”€ processors/                # åŠ¨æ•å¤„ç†å™¨ï¼ˆæ–°ï¼‰
â”‚       â”‚   â”œâ”€â”€ PoseProcessor.ts      # å§¿æ€å¤„ç†å™¨
â”‚       â”‚   â”œâ”€â”€ FaceProcessor.ts      # é¢éƒ¨å¤„ç†å™¨
â”‚       â”‚   â””â”€â”€ HandProcessor.ts      # æ‰‹éƒ¨å¤„ç†å™¨
â”‚       â””â”€â”€ pipeline.ts                # æ•°æ®ç®¡é“ï¼ˆæ–°ï¼‰
â”‚
â””â”€â”€ components/
    â”œâ”€â”€ dressing-room/
    â”‚   â”œâ”€â”€ VRMAvatarContainer.tsx    # å®¹å™¨ç»„ä»¶ï¼ˆæ–°ï¼‰
    â”‚   â””â”€â”€ VRMAvatar3D.tsx           # çº¯ 3D æ¸²æŸ“ç»„ä»¶ï¼ˆæ–°ï¼Œæ›¿æ¢ VRMAvatar.tsxï¼‰
    â””â”€â”€ ui/
        â””â”€â”€ ModelLoadingIndicator.tsx # UI ç»„ä»¶ï¼ˆæ–°ï¼Œä» VRMAvatar.tsx æå–ï¼‰
```

#### æ‹†åˆ†æ­¥éª¤

1. âœ… **æå– UI ç»„ä»¶** â†’ `components/ui/ModelLoadingIndicator.tsx`
2. âœ… **æå–åŠ¨æ•å¤„ç†å™¨** â†’ `lib/mocap/processors/`
3. âœ… **æå–åŠ¨æ•ç®¡é“ Hook** â†’ `hooks/use-vrm-mocap-pipeline.ts`
4. âœ… **æå–éª¨éª¼æ§åˆ¶ Hook** â†’ `hooks/use-vrm-bone-control.ts`
5. âœ… **åˆ›å»ºå®¹å™¨ç»„ä»¶** â†’ `components/dressing-room/VRMAvatarContainer.tsx`
6. âœ… **åˆ›å»ºçº¯æ¸²æŸ“ç»„ä»¶** â†’ `components/dressing-room/VRMAvatar3D.tsx`

---

## ğŸ¯ ä¼˜å…ˆçº§

### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆå¿…é¡»ä¿®å¤ï¼‰

1. **VRMAvatar.tsx æ‹†åˆ†** (1161 è¡Œ â†’ < 300 è¡Œ)
   - å½±å“ï¼šä»£ç è´¨é‡ã€å¯ç»´æŠ¤æ€§ã€å¯æµ‹è¯•æ€§
   - å·¥ä½œé‡ï¼šå¤§ï¼ˆéœ€è¦é‡æ„ï¼‰
   - é£é™©ï¼šé«˜ï¼ˆæ ¸å¿ƒç»„ä»¶ï¼‰

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆå»ºè®®ä¿®å¤ï¼‰

2. æ£€æŸ¥å…¶ä»–æ–‡ä»¶æ˜¯å¦è¶…è¿‡ 300 è¡Œ
3. éªŒè¯æ‰€æœ‰ Hooks æ˜¯å¦å¯å•ç‹¬æµ‹è¯•
4. éªŒè¯æ‰€æœ‰ç»„ä»¶æ˜¯å¦ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™

---

## ğŸ“‹ æ£€æŸ¥æ¸…å•æ€»ç»“

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | é—®é¢˜ |
|--------|------|------|
| æ–‡ä»¶å¤§å° < 300 è¡Œ | âŒ | VRMAvatar.tsx (1161 è¡Œ) |
| èŒè´£å•ä¸€ | âŒ | VRMAvatar.tsx èŒè´£è¿‡å¤š |
| æ˜“äºæµ‹è¯• | âš ï¸ | VRMAvatar.tsx éš¾ä»¥æµ‹è¯• |
| æ˜“äºç»´æŠ¤ | âŒ | ä¿®æ”¹åŠ¨æ•é€»è¾‘éœ€è¦æ”¹å¤§æ–‡ä»¶ |
| ä»£ç å¯å¤ç”¨ | âš ï¸ | VRMAvatar.tsx é€»è¾‘éš¾ä»¥å¤ç”¨ |

**ç»“è®º**: **VRMAvatar.tsx æ˜¯ä¸»è¦é—®é¢˜ï¼Œéœ€è¦æŒ‰ `.cursorrules` è§„èŒƒè¿›è¡Œé‡æ„ã€‚**

